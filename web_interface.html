<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Log Analysis & AI Assistant</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            color: #7f8c8d;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-healthy {
            background: #27ae60;
        }

        .status-warning {
            background: #f39c12;
        }

        .status-error {
            background: #e74c3c;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }

        .btn:hover {
            background: #2980b9;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .large-modal {
            max-width: 900px;
            width: 90%;
        }

        .model-search-section {
            margin-bottom: 20px;
        }

        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .search-controls input {
            flex: 1;
            min-width: 200px;
        }

        .search-controls select {
            min-width: 150px;
        }

        .model-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .model-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .model-item:hover {
            background-color: #f8f9fa;
        }

        .model-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
        }

        .model-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .model-meta {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .model-description {
            font-size: 14px;
            color: #555;
            margin-bottom: 8px;
        }

        .model-stats {
            display: flex;
            gap: 15px;
            font-size: 12px;
            color: #7f8c8d;
        }

        .model-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
        }

        .btn-primary {
            background: #2196f3;
        }

        .btn-primary:hover {
            background: #1976d2;
        }

        .model-details-section {
            border-top: 1px solid #ddd;
            padding-top: 20px;
            margin-top: 20px;
        }

        .model-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .algorithm-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .algorithm-section h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }

        .algorithm-detail {
            margin: 10px 0;
            padding: 8px;
            background: #fff;
            border-radius: 3px;
        }

        .algorithm-detail strong {
            color: #34495e;
        }

        .advantage-list, .limitation-list {
            margin: 10px 0;
            padding-left: 20px;
        }

        .advantage-list li {
            color: #27ae60;
        }

        .limitation-list li {
            color: #e74c3c;
        }

        .btn-secondary {
            background: #95a5a6;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        /* Table Styles */
        .log-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .log-table th {
            background: #2c3e50;
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            border-bottom: 2px solid #34495e;
        }

        .log-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #ecf0f1;
            font-size: 13px;
            vertical-align: top;
        }

        .log-table tr:hover {
            background: #f8f9fa;
        }

        .log-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .log-level {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .log-level.error {
            background: #e74c3c;
            color: white;
        }

        .log-level.warning {
            background: #f39c12;
            color: white;
        }

        .log-level.info {
            background: #3498db;
            color: white;
        }

        .log-level.debug {
            background: #95a5a6;
            color: white;
        }

        .log-timestamp {
            color: #7f8c8d;
            font-size: 12px;
            white-space: nowrap;
        }

        .log-source {
            font-weight: 500;
            color: #2c3e50;
        }

        .log-message {
            max-width: 300px;
            word-wrap: break-word;
        }

        .log-metadata {
            font-size: 11px;
            color: #7f8c8d;
            max-width: 200px;
            word-wrap: break-word;
        }

        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }

        .table-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .table-controls input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .table-controls select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .table-controls button {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .table-controls button:hover {
            background: #2980b9;
        }

        .log-count {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        /* Legacy styles for backward compatibility */
        .log-entry {
            background: #f8f9fa;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }

        .log-entry.error {
            border-left-color: #e74c3c;
        }

        .log-entry.warning {
            border-left-color: #f39c12;
        }

        .log-entry.info {
            border-left-color: #3498db;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }

        .metric-label {
            font-size: 12px;
            color: #7f8c8d;
            text-transform: uppercase;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .graphs-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .graph-card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .graph-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>System Log Analysis & AI Assistant</h1>
            <p>Monitor system logs, analyze patterns, and get AI-powered insights about your system state</p>
        </div>

        <div class="dashboard">
            <!-- System Health -->
            <div class="card">
                <h3>System Health</h3>
                <div id="health-status">
                    <div class="loading">Loading system health...</div>
                </div>
                <div class="metrics" id="health-metrics"></div>
                <button class="btn" onclick="refreshHealth()">Refresh Health</button>
            </div>

            <!-- Log Collection -->
            <div class="card">
                <h3>Log Collection</h3>
                <div id="log-status">
                    <div class="loading">Loading log status...</div>
                </div>
                <button class="btn" onclick="collectLogs()">Collect Logs</button>
                <button class="btn btn-secondary" onclick="getRecentLogs()">View Recent Logs</button>
            </div>

                    <!-- Latent Space -->
        <div class="card">
            <h3>Latent Space</h3>
            <div id="latent-space-status">
                <div class="loading">Loading latent space status...</div>
            </div>
            <button class="btn" onclick="rebuildLatentSpace()">Rebuild Latent Space</button>
            <button class="btn" onclick="showAlgorithmInfo()">View Algorithm Details</button>
        </div>

        <!-- Algorithm Information Modal -->
        <div id="algorithm-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="closeAlgorithmModal()">&times;</span>
                <h2>Latent Space Algorithm Details</h2>
                <div id="algorithm-info-content">
                    <div class="loading">Loading algorithm information...</div>
                </div>
            </div>
        </div>

        <!-- Model Selector Modal -->
        <div id="model-selector-modal" class="modal" style="display: none;">
            <div class="modal-content large-modal">
                <span class="close" onclick="closeModelSelector()">&times;</span>
                <h2>Select Model from Hugging Face</h2>
                <div class="model-search-section">
                    <div class="search-controls">
                        <input type="text" id="model-search" placeholder="Search models (e.g., 'system log', 'qa', 'distilbert')" onkeyup="searchModels()">
                        <select id="model-task-filter" onchange="searchModels()">
                            <option value="question-answering">Question Answering</option>
                            <option value="text-classification">Text Classification</option>
                            <option value="text-generation">Text Generation</option>
                            <option value="summarization">Summarization</option>
                        </select>
                        <button class="btn" onclick="searchModels()">Search</button>
                        <button class="btn" onclick="getRecommendedModels()">Show Recommended</button>
                    </div>
                    <div id="model-search-results"></div>
                </div>
                <div class="model-details-section" id="model-details" style="display: none;">
                    <h3>Model Details</h3>
                    <div id="selected-model-info"></div>
                    <div class="model-actions">
                        <button class="btn btn-primary" onclick="downloadModel()">Download Model</button>
                        <button class="btn" onclick="closeModelDetails()">Close</button>
                    </div>
                </div>
            </div>
        </div>

            <!-- AI Model -->
            <div class="card">
                <h3>AI Model Management</h3>
                <div id="model-status">
                    <div class="loading">Loading model status...</div>
                </div>
                <div class="model-controls">
                    <button class="btn" onclick="showModelSelector()">Select Model</button>
                    <button class="btn" onclick="downloadSelectedModel()">Download Model</button>
                    <button class="btn" onclick="trainModel()">Train Model</button>
                    <button class="btn" onclick="getModelStatus()">Refresh Status</button>
                </div>
            </div>
        </div>

        <!-- Graphs Section -->
        <div class="graphs-section">
            <!-- Latent Space Volume Graph -->
            <div class="graph-card">
                <h4>Latent Space Volume</h4>
                <div class="chart-container">
                    <canvas id="latentSpaceChart"></canvas>
                </div>
            </div>

            <!-- Log Volume Over Time -->
            <div class="graph-card">
                <h4>Log Volume Over Time</h4>
                <div class="chart-container">
                    <canvas id="logVolumeChart"></canvas>
                </div>
            </div>

            <!-- System Metrics -->
            <div class="graph-card">
                <h4>System Metrics</h4>
                <div class="chart-container">
                    <canvas id="systemMetricsChart"></canvas>
                </div>
            </div>

            <!-- Log Levels Distribution -->
            <div class="graph-card">
                <h4>Log Levels Distribution</h4>
                <div class="chart-container">
                    <canvas id="logLevelsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Question Answering -->
        <div class="card">
            <h3>Ask Questions About System State</h3>
            <div class="form-group">
                <label for="question">Question:</label>
                <textarea id="question" placeholder="Ask about system performance, security issues, hardware problems, etc..."></textarea>
            </div>
            <button class="btn" onclick="askQuestion()">Ask Question</button>
            <div id="question-result"></div>
        </div>

        <!-- Recent Logs -->
        <div class="card">
            <h3>Recent System Logs</h3>
            <div class="form-group">
                <label for="log-minutes">Minutes to look back:</label>
                <select id="log-minutes">
                    <option value="10">10 minutes</option>
                    <option value="30">30 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="1440">24 hours</option>
                </select>
            </div>
            <button class="btn" onclick="getRecentLogs()">Load Logs</button>
            <div id="recent-logs"></div>
        </div>

        <!-- Minute Log Capture -->
        <div class="card">
            <h3>Minute Log Capture</h3>
            <div id="minute-log-status">
                <div class="loading">Loading minute log status...</div>
            </div>
            <button class="btn" onclick="captureMinuteLogs()">Capture Logs Now</button>
            <button class="btn btn-secondary" onclick="getMinuteLogs()">View Last Minute Logs</button>
            <button class="btn btn-secondary" onclick="getMinuteLogStats()">View Statistics</button>
            <div id="minute-logs"></div>
        </div>

        <!-- System Information -->
        <div class="card">
            <h3>System Information</h3>
            <div id="system-info">
                <div class="loading">Loading system information...</div>
            </div>
            <button class="btn" onclick="getSystemInfo()">Refresh System Info</button>
        </div>
    </div>

    <script>
        // Chart instances
        let latentSpaceChart, logVolumeChart, systemMetricsChart, logLevelsChart;
        
        // Data storage for charts
        let chartData = {
            latentSpace: [],
            logVolume: [],
            systemMetrics: [],
            logLevels: []
        };

        // Initialize charts
        function initializeCharts() {
            // Latent Space Volume Chart
            const latentSpaceCtx = document.getElementById('latentSpaceChart').getContext('2d');
            latentSpaceChart = new Chart(latentSpaceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Embeddings Count',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Log Volume Chart
            const logVolumeCtx = document.getElementById('logVolumeChart').getContext('2d');
            logVolumeChart = new Chart(logVolumeCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Logs per Minute',
                        data: [],
                        backgroundColor: '#27ae60',
                        borderColor: '#27ae60',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // System Metrics Chart
            const systemMetricsCtx = document.getElementById('systemMetricsChart').getContext('2d');
            systemMetricsChart = new Chart(systemMetricsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU Usage (%)',
                        data: [],
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Memory Usage (%)',
                        data: [],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });

            // Log Levels Chart
            const logLevelsCtx = document.getElementById('logLevelsChart').getContext('2d');
            logLevelsChart = new Chart(logLevelsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Info', 'Warning', 'Error', 'Debug'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#27ae60',
                            '#f39c12',
                            '#e74c3c',
                            '#3498db'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Update charts with new data
        function updateCharts() {
            // Update latent space chart
            if (chartData.latentSpace.length > 10) {
                chartData.latentSpace = chartData.latentSpace.slice(-10);
            }
            latentSpaceChart.data.labels = chartData.latentSpace.map(d => d.time);
            latentSpaceChart.data.datasets[0].data = chartData.latentSpace.map(d => d.count);
            latentSpaceChart.update();

            // Update log volume chart
            if (chartData.logVolume.length > 10) {
                chartData.logVolume = chartData.logVolume.slice(-10);
            }
            logVolumeChart.data.labels = chartData.logVolume.map(d => d.time);
            logVolumeChart.data.datasets[0].data = chartData.logVolume.map(d => d.count);
            logVolumeChart.update();

            // Update system metrics chart
            if (chartData.systemMetrics.length > 10) {
                chartData.systemMetrics = chartData.systemMetrics.slice(-10);
            }
            systemMetricsChart.data.labels = chartData.systemMetrics.map(d => d.time);
            systemMetricsChart.data.datasets[0].data = chartData.systemMetrics.map(d => d.cpu);
            systemMetricsChart.data.datasets[1].data = chartData.systemMetrics.map(d => d.memory);
            systemMetricsChart.update();

            // Update log levels chart
            logLevelsChart.data.datasets[0].data = [
                chartData.logLevels.info || 0,
                chartData.logLevels.warning || 0,
                chartData.logLevels.error || 0,
                chartData.logLevels.debug || 0
            ];
            logLevelsChart.update();
        }

        // API helper function
        async function apiCall(endpoint, options = {}) {
            const response = await fetch(`/api/v1${endpoint}`, {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            });
            
            if (!response.ok) {
                const error = await response.text();
                throw new Error(error);
            }
            
            return await response.json();
        }

        // Helper functions
        function showLoading(elementId) {
            document.getElementById(elementId).innerHTML = '<div class="loading">Loading...</div>';
        }

        function showMessage(elementId, message, type = 'info') {
            const className = type === 'error' ? 'error-message' : 'success-message';
            document.getElementById(elementId).innerHTML = `<div class="${className}">${message}</div>`;
        }

        // Health check
        async function refreshHealth() {
            showLoading('health-status');
            try {
                const health = await apiCall('/health');
                const statusElement = document.getElementById('health-status');
                
                const statusClass = health.status === 'healthy' ? 'status-healthy' : 'status-warning';
                statusElement.innerHTML = `
                    <div>
                        <span class="status-indicator ${statusClass}"></span>
                        <strong>Status:</strong> ${health.status}
                    </div>
                    <div><strong>Uptime:</strong> ${Math.floor(health.uptime / 3600)}h ${Math.floor((health.uptime % 3600) / 60)}m</div>
                    <div><strong>Memory:</strong> ${health.memory_usage.toFixed(1)}%</div>
                    <div><strong>CPU:</strong> ${health.cpu_usage.toFixed(1)}%</div>
                `;
                
                // Update system metrics chart
                const now = new Date().toLocaleTimeString();
                chartData.systemMetrics.push({
                    time: now,
                    cpu: health.cpu_usage,
                    memory: health.memory_usage
                });
                updateCharts();
                
            } catch (error) {
                showMessage('health-status', `Failed to load health status: ${error.message}`, 'error');
            }
        }

        // Log collection
        async function collectLogs() {
            showLoading('log-status');
            try {
                const result = await apiCall('/logs/collect', { method: 'POST' });
                showMessage('log-status', result.message, 'success');
            } catch (error) {
                showMessage('log-status', `Failed to collect logs: ${error.message}`, 'error');
            }
        }

        async function getRecentLogs() {
            const minutes = document.getElementById('log-minutes').value;
            showLoading('recent-logs');
            try {
                const logs = await apiCall(`/logs/recent?minutes=${minutes}`);
                const logsElement = document.getElementById('recent-logs');
                
                if (logs.length === 0) {
                    logsElement.innerHTML = '<div class="loading">No logs found for the specified time period</div>';
                    return;
                }

                const tableHTML = `
                    <div class="table-container">
                        <div class="log-count">Recent Logs (${logs.length} entries from last ${minutes} minutes)</div>
                        <div class="table-controls">
                            <input type="text" id="log-search" placeholder="Search logs..." onkeyup="filterLogs()">
                            <select id="level-filter" onchange="filterLogs()">
                                <option value="">All Levels</option>
                                <option value="error">Error</option>
                                <option value="warning">Warning</option>
                                <option value="info">Info</option>
                                <option value="debug">Debug</option>
                            </select>
                            <select id="source-filter" onchange="filterLogs()">
                                <option value="">All Sources</option>
                                ${[...new Set(logs.map(log => log.source))].map(source => 
                                    `<option value="${source}">${source}</option>`
                                ).join('')}
                            </select>
                            <button onclick="exportLogs()">Export CSV</button>
                        </div>
                        <table class="log-table" id="logs-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Level</th>
                                    <th>Source</th>
                                    <th>Message</th>
                                    <th>Metadata</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${logs.map(log => `
                                    <tr data-level="${log.level}" data-source="${log.source}" data-message="${(log.message || '').toLowerCase()}">
                                        <td class="log-timestamp">${new Date(log.timestamp).toLocaleString()}</td>
                                        <td><span class="log-level ${log.level}">${log.level}</span></td>
                                        <td class="log-source">${log.source}</td>
                                        <td class="log-message">${log.message || ''}</td>
                                        <td class="log-metadata">${log.metadata ? JSON.stringify(log.metadata).substring(0, 100) + (JSON.stringify(log.metadata).length > 100 ? '...' : '') : ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                logsElement.innerHTML = tableHTML;
            } catch (error) {
                showMessage('recent-logs', `Failed to load logs: ${error.message}`, 'error');
            }
        }

        // Latent space
        async function rebuildLatentSpace() {
            showLoading('latent-space-status');
            try {
                const result = await apiCall('/latent-space/rebuild', { method: 'POST' });
                showMessage('latent-space-status', result.message, 'success');
                setTimeout(() => getLatentSpaceStatus(), 1000);
            } catch (error) {
                showMessage('latent-space-status', `Failed to rebuild latent space: ${error.message}`, 'error');
            }
        }

        async function getLatentSpaceStatus() {
            showLoading('latent-space-status');
            try {
                const status = await apiCall('/latent-space/status');
                const statusElement = document.getElementById('latent-space-status');
                
                const statusClass = status.is_initialized ? 'status-healthy' : 'status-warning';
                
                // Create detailed status display
                let statusHTML = `
                    <div>
                        <span class="status-indicator ${statusClass}"></span>
                        <strong>Status:</strong> ${status.is_initialized ? 'Initialized' : 'Not Initialized'}
                    </div>
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${status.total_embeddings}</div>
                            <div class="metric-label">Embeddings</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${status.dimension}</div>
                            <div class="metric-label">Dimension</div>
                        </div>
                        ${status.memory_usage_mb ? `
                        <div class="metric">
                            <div class="metric-value">${status.memory_usage_mb}MB</div>
                            <div class="metric-label">Memory</div>
                        </div>
                        ` : ''}
                        ${status.average_embedding_length ? `
                        <div class="metric">
                            <div class="metric-value">${status.average_embedding_length}</div>
                            <div class="metric-label">Avg Length</div>
                        </div>
                        ` : ''}
                    </div>
                    <div><strong>Model:</strong> ${status.model_name}</div>
                    ${status.index_type ? `<div><strong>Index Type:</strong> ${status.index_type}</div>` : ''}
                    ${status.index_size ? `<div><strong>Index Size:</strong> ${status.index_size} vectors</div>` : ''}
                    ${status.last_updated ? `<div><strong>Last Updated:</strong> ${new Date(status.last_updated).toLocaleString()}</div>` : ''}
                `;
                
                // Add sources distribution if available
                if (status.sources_distribution && Object.keys(status.sources_distribution).length > 0) {
                    statusHTML += `<div><strong>Sources:</strong> ${Object.entries(status.sources_distribution).map(([source, count]) => `${source}: ${count}`).join(', ')}</div>`;
                }
                
                // Add levels distribution if available
                if (status.levels_distribution && Object.keys(status.levels_distribution).length > 0) {
                    statusHTML += `<div><strong>Levels:</strong> ${Object.entries(status.levels_distribution).map(([level, count]) => `${level}: ${count}`).join(', ')}</div>`;
                }
                
                statusElement.innerHTML = statusHTML;
                
                // Update latent space chart
                const now = new Date().toLocaleTimeString();
                chartData.latentSpace.push({
                    time: now,
                    count: status.total_embeddings
                });
                updateCharts();
                
            } catch (error) {
                showMessage('latent-space-status', `Failed to load latent space status: ${error.message}`, 'error');
            }
        }

        // Algorithm information
        async function showAlgorithmInfo() {
            const modal = document.getElementById('algorithm-modal');
            const content = document.getElementById('algorithm-info-content');
            
            modal.style.display = 'block';
            content.innerHTML = '<div class="loading">Loading algorithm information...</div>';
            
            try {
                const algorithmInfo = await apiCall('/latent-space/algorithm-info');
                
                content.innerHTML = `
                    <div class="algorithm-section">
                        <h3>Embedding Model</h3>
                        <div class="algorithm-detail">
                            <strong>Name:</strong> ${algorithmInfo.embedding_model.name}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Type:</strong> ${algorithmInfo.embedding_model.type}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Architecture:</strong> ${algorithmInfo.embedding_model.architecture}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Dimension:</strong> ${algorithmInfo.embedding_model.dimension}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Description:</strong> ${algorithmInfo.embedding_model.description}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Advantages:</strong>
                            <ul class="advantage-list">
                                ${algorithmInfo.embedding_model.advantages.map(adv => `<li>${adv}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="algorithm-detail">
                            <strong>Technical Details:</strong>
                            <ul>
                                <li>Base Model: ${algorithmInfo.embedding_model.technical_details.base_model}</li>
                                <li>Distillation: ${algorithmInfo.embedding_model.technical_details.distillation}</li>
                                <li>Vocabulary Size: ${algorithmInfo.embedding_model.technical_details.vocabulary_size}</li>
                                <li>Attention Heads: ${algorithmInfo.embedding_model.technical_details.attention_heads}</li>
                                <li>Layers: ${algorithmInfo.embedding_model.technical_details.layers}</li>
                            </ul>
                        </div>
                    </div>

                    <div class="algorithm-section">
                        <h3>Similarity Algorithm</h3>
                        <div class="algorithm-detail">
                            <strong>Type:</strong> ${algorithmInfo.similarity_algorithm.type}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Implementation:</strong> ${algorithmInfo.similarity_algorithm.implementation}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Normalization:</strong> ${algorithmInfo.similarity_algorithm.normalization}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Threshold:</strong> ${algorithmInfo.similarity_algorithm.threshold}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Mathematical Formula:</strong> ${algorithmInfo.similarity_algorithm.mathematical_formula}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Description:</strong> ${algorithmInfo.similarity_algorithm.description}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Advantages:</strong>
                            <ul class="advantage-list">
                                ${algorithmInfo.similarity_algorithm.advantages.map(adv => `<li>${adv}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="algorithm-section">
                        <h3>Indexing Algorithm</h3>
                        <div class="algorithm-detail">
                            <strong>Type:</strong> ${algorithmInfo.indexing_algorithm.type}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Algorithm:</strong> ${algorithmInfo.indexing_algorithm.algorithm}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Batch Size:</strong> ${algorithmInfo.indexing_algorithm.batch_size}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Search Complexity:</strong> ${algorithmInfo.indexing_algorithm.search_complexity}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Memory Usage:</strong> ${algorithmInfo.indexing_algorithm.memory_usage}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Description:</strong> ${algorithmInfo.indexing_algorithm.description}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Advantages:</strong>
                            <ul class="advantage-list">
                                ${algorithmInfo.indexing_algorithm.advantages.map(adv => `<li>${adv}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="algorithm-detail">
                            <strong>Limitations:</strong>
                            <ul class="limitation-list">
                                ${algorithmInfo.indexing_algorithm.limitations.map(lim => `<li>${lim}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="algorithm-section">
                        <h3>Text Preprocessing</h3>
                        <div class="algorithm-detail">
                            <strong>Format:</strong> ${algorithmInfo.text_preprocessing.format}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Fields:</strong> ${algorithmInfo.text_preprocessing.fields.join(', ')}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Separator:</strong> "${algorithmInfo.text_preprocessing.separator}"
                        </div>
                        <div class="algorithm-detail">
                            <strong>Example:</strong> ${algorithmInfo.text_preprocessing.example}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Description:</strong> ${algorithmInfo.text_preprocessing.description}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Advantages:</strong>
                            <ul class="advantage-list">
                                ${algorithmInfo.text_preprocessing.advantages.map(adv => `<li>${adv}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    <div class="algorithm-section">
                        <h3>Performance Characteristics</h3>
                        <div class="algorithm-detail">
                            <strong>Embedding Generation:</strong> ${algorithmInfo.performance_characteristics.embedding_generation}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Similarity Search:</strong> ${algorithmInfo.performance_characteristics.similarity_search}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Memory Efficiency:</strong> ${algorithmInfo.performance_characteristics.memory_efficiency}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Storage Format:</strong> ${algorithmInfo.performance_characteristics.storage_format}
                        </div>
                        <div class="algorithm-detail">
                            <strong>Persistence:</strong> ${algorithmInfo.performance_characteristics.persistence}
                        </div>
                    </div>
                `;
            } catch (error) {
                content.innerHTML = `<div class="error">Failed to load algorithm information: ${error.message}</div>`;
            }
        }

        function closeAlgorithmModal() {
            document.getElementById('algorithm-modal').style.display = 'none';
        }

        // Model training
        async function trainModel() {
            showLoading('model-status');
            try {
                const result = await apiCall('/model/train', {
                    method: 'POST',
                    body: JSON.stringify({ epochs: 10, batch_size: 32 })
                });
                showMessage('model-status', result.message, 'success');
                setTimeout(() => getModelStatus(), 1000);
            } catch (error) {
                showMessage('model-status', `Failed to train model: ${error.message}`, 'error');
            }
        }

        async function getModelStatus() {
            showLoading('model-status');
            try {
                const status = await apiCall('/model/status');
                const statusElement = document.getElementById('model-status');
                
                const statusClass = status.is_trained ? 'status-healthy' : 'status-warning';
                statusElement.innerHTML = `
                    <div>
                        <span class="status-indicator ${statusClass}"></span>
                        <strong>Status:</strong> ${status.is_trained ? 'Trained' : 'Not Trained'}
                    </div>
                    <div><strong>Training Runs:</strong> ${status.total_samples}</div>
                    ${status.last_trained ? `<div><strong>Last Trained:</strong> ${new Date(status.last_trained).toLocaleString()}</div>` : ''}
                    ${status.accuracy ? `<div><strong>Accuracy:</strong> ${(status.accuracy * 100).toFixed(1)}%</div>` : ''}
                    ${status.current_model ? `<div><strong>Current Model:</strong> ${status.current_model}</div>` : ''}
                `;
            } catch (error) {
                showMessage('model-status', `Failed to load model status: ${error.message}`, 'error');
            }
        }

        // Model selection and download functions
        let selectedModel = null;
        let searchResults = [];

        function showModelSelector() {
            document.getElementById('model-selector-modal').style.display = 'block';
            getRecommendedModels();
        }

        function closeModelSelector() {
            document.getElementById('model-selector-modal').style.display = 'none';
            selectedModel = null;
        }

        async function searchModels() {
            const query = document.getElementById('model-search').value;
            const task = document.getElementById('model-task-filter').value;
            
            if (!query.trim()) {
                getRecommendedModels();
                return;
            }

            showLoading('model-search-results');
            try {
                const result = await apiCall('/models/search', {
                    method: 'POST',
                    body: JSON.stringify({ query, task, limit: 20 })
                });

                if (result.success) {
                    displayModelResults(result.models);
                } else {
                    showMessage('model-search-results', result.message, 'error');
                }
            } catch (error) {
                showMessage('model-search-results', `Search failed: ${error.message}`, 'error');
            }
        }

        async function getRecommendedModels() {
            showLoading('model-search-results');
            try {
                const result = await apiCall('/models/recommended');
                
                if (result.success) {
                    const allModels = [];
                    Object.values(result.recommendations).forEach(category => {
                        allModels.push(...category);
                    });
                    displayModelResults(allModels);
                } else {
                    showMessage('model-search-results', result.message, 'error');
                }
            } catch (error) {
                showMessage('model-search-results', `Failed to get recommendations: ${error.message}`, 'error');
            }
        }

        function displayModelResults(models) {
            searchResults = models;
            const resultsElement = document.getElementById('model-search-results');
            
            if (models.length === 0) {
                resultsElement.innerHTML = '<div class="loading">No models found</div>';
                return;
            }

            const modelsHTML = `
                <div class="model-list">
                    ${models.map((model, index) => `
                        <div class="model-item" onclick="selectModel(${index})">
                            <div class="model-name">${model.model_id}</div>
                            <div class="model-meta">by ${model.author} • ${model.size_mb}MB</div>
                            <div class="model-description">${model.description.substring(0, 150)}${model.description.length > 150 ? '...' : ''}</div>
                            <div class="model-stats">
                                <span>📥 ${model.downloads.toLocaleString()} downloads</span>
                                <span>❤️ ${model.likes} likes</span>
                                <span>⭐ ${model.suitability_score} score</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            resultsElement.innerHTML = modelsHTML;
        }

        function selectModel(index) {
            selectedModel = searchResults[index];
            
            // Update UI
            document.querySelectorAll('.model-item').forEach(item => item.classList.remove('selected'));
            event.target.closest('.model-item').classList.add('selected');
            
            // Show model details
            showModelDetails(selectedModel);
        }

        function showModelDetails(model) {
            const detailsElement = document.getElementById('selected-model-info');
            const detailsSection = document.getElementById('model-details');
            
            detailsElement.innerHTML = `
                <div class="model-details">
                    <h4>${model.model_id}</h4>
                    <p><strong>Author:</strong> ${model.author}</p>
                    <p><strong>Size:</strong> ${model.size_mb}MB</p>
                    <p><strong>Downloads:</strong> ${model.downloads.toLocaleString()}</p>
                    <p><strong>Likes:</strong> ${model.likes}</p>
                    <p><strong>Suitability Score:</strong> ${model.suitability_score}/100</p>
                    <p><strong>Description:</strong> ${model.description}</p>
                    <p><strong>Tags:</strong> ${model.tags.join(', ')}</p>
                    <p><strong>URL:</strong> <a href="${model.url}" target="_blank">View on Hugging Face</a></p>
                </div>
            `;
            
            detailsSection.style.display = 'block';
        }

        function closeModelDetails() {
            document.getElementById('model-details').style.display = 'none';
            selectedModel = null;
        }

        async function downloadModel() {
            if (!selectedModel) {
                alert('Please select a model first');
                return;
            }

            const downloadBtn = document.querySelector('.btn-primary');
            const originalText = downloadBtn.textContent;
            downloadBtn.textContent = 'Downloading...';
            downloadBtn.disabled = true;

            try {
                const result = await apiCall('/models/download', {
                    method: 'POST',
                    body: JSON.stringify({ model_id: selectedModel.model_id })
                });

                if (result.success) {
                    showMessage('model-status', `Model ${selectedModel.model_id} downloaded successfully!`, 'success');
                    closeModelSelector();
                    getModelStatus();
                } else {
                    showMessage('model-status', `Download failed: ${result.message}`, 'error');
                }
            } catch (error) {
                showMessage('model-status', `Download failed: ${error.message}`, 'error');
            } finally {
                downloadBtn.textContent = originalText;
                downloadBtn.disabled = false;
            }
        }

        async function downloadSelectedModel() {
            if (!selectedModel) {
                showModelSelector();
                return;
            }
            await downloadModel();
        }

        // Question answering
        async function askQuestion() {
            const question = document.getElementById('question').value.trim();
            if (!question) {
                showMessage('question-result', 'Please enter a question', 'error');
                return;
            }

            showLoading('question-result');
            try {
                const result = await apiCall('/qa/ask', {
                    method: 'POST',
                    body: JSON.stringify({ question })
                });
                
                const resultElement = document.getElementById('question-result');
                resultElement.innerHTML = `
                    <div class="success-message">
                        <h4>Answer:</h4>
                        <p>${result.answer}</p>
                        <p><strong>Confidence:</strong> ${(result.confidence * 100).toFixed(1)}%</p>
                        ${result.sources.length > 0 ? `
                            <h4>Sources:</h4>
                            <ul>
                                ${result.sources.map(source => `<li>${source}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                showMessage('question-result', `Failed to get answer: ${error.message}`, 'error');
            }
        }

        // Minute log capture
        async function captureMinuteLogs() {
            showLoading('minute-log-status');
            try {
                const result = await apiCall('/logs/minute/capture', { method: 'POST' });
                showMessage('minute-log-status', result.message, 'success');
                
                // Update log volume chart
                const now = new Date().toLocaleTimeString();
                chartData.logVolume.push({
                    time: now,
                    count: result.logs_collected
                });
                updateCharts();
                
                setTimeout(() => getMinuteLogStats(), 1000);
            } catch (error) {
                showMessage('minute-log-status', `Failed to capture logs: ${error.message}`, 'error');
            }
        }

        async function getMinuteLogs() {
            showLoading('minute-logs');
            try {
                const result = await apiCall('/logs/minute');
                const logsElement = document.getElementById('minute-logs');
                
                if (result.logs.length === 0) {
                    logsElement.innerHTML = '<div class="loading">No logs found in the last minute</div>';
                    return;
                }

                const tableHTML = `
                    <div class="table-container">
                        <div class="log-count">Last Minute Logs (${result.count} entries)</div>
                        <div class="table-controls">
                            <input type="text" id="minute-log-search" placeholder="Search logs..." onkeyup="filterMinuteLogs()">
                            <select id="minute-level-filter" onchange="filterMinuteLogs()">
                                <option value="">All Levels</option>
                                <option value="error">Error</option>
                                <option value="warning">Warning</option>
                                <option value="info">Info</option>
                                <option value="debug">Debug</option>
                            </select>
                            <select id="minute-source-filter" onchange="filterMinuteLogs()">
                                <option value="">All Sources</option>
                                ${[...new Set(result.logs.map(log => log.source))].map(source => 
                                    `<option value="${source}">${source}</option>`
                                ).join('')}
                            </select>
                            <button onclick="exportMinuteLogs()">Export CSV</button>
                        </div>
                        <table class="log-table" id="minute-logs-table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Level</th>
                                    <th>Source</th>
                                    <th>Message</th>
                                    <th>Metadata</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${result.logs.map(log => `
                                    <tr data-level="${log.level}" data-source="${log.source}" data-message="${(log.message || '').toLowerCase()}">
                                        <td class="log-timestamp">${new Date(log.timestamp).toLocaleString()}</td>
                                        <td><span class="log-level ${log.level}">${log.level}</span></td>
                                        <td class="log-source">${log.source}</td>
                                        <td class="log-message">${log.message || ''}</td>
                                        <td class="log-metadata">${log.metadata ? JSON.stringify(log.metadata).substring(0, 100) + (JSON.stringify(log.metadata).length > 100 ? '...' : '') : ''}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                
                logsElement.innerHTML = tableHTML;
            } catch (error) {
                showMessage('minute-logs', `Failed to load minute logs: ${error.message}`, 'error');
            }
        }

        async function getMinuteLogStats() {
            showLoading('minute-log-status');
            try {
                const result = await apiCall('/logs/minute/statistics');
                const statusElement = document.getElementById('minute-log-status');
                const stats = result.statistics;
                
                statusElement.innerHTML = `
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${stats.total_logs || 0}</div>
                            <div class="metric-label">Total Logs</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${stats.by_level?.error || 0}</div>
                            <div class="metric-label">Errors</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${stats.by_level?.warning || 0}</div>
                            <div class="metric-label">Warnings</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${stats.by_level?.info || 0}</div>
                            <div class="metric-label">Info</div>
                        </div>
                    </div>
                    <div><strong>Time Range:</strong> Last ${stats.time_range_minutes || 1} minute(s)</div>
                    <div><strong>Last Updated:</strong> ${new Date(result.timestamp).toLocaleString()}</div>
                `;
                
                // Update log levels chart
                chartData.logLevels = stats.by_level || {};
                updateCharts();
                
            } catch (error) {
                showMessage('minute-log-status', `Failed to load minute log statistics: ${error.message}`, 'error');
            }
        }

        // System information
        async function getSystemInfo() {
            showLoading('system-info');
            try {
                const info = await apiCall('/system/info');
                const infoElement = document.getElementById('system-info');
                
                infoElement.innerHTML = `
                    <div class="metrics">
                        <div class="metric">
                            <div class="metric-value">${info.cpu.count}</div>
                            <div class="metric-label">CPU Cores</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${info.cpu.usage_percent.toFixed(1)}%</div>
                            <div class="metric-label">CPU Usage</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${(info.memory.total / 1024 / 1024 / 1024).toFixed(1)}GB</div>
                            <div class="metric-label">Total Memory</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${info.memory.percent.toFixed(1)}%</div>
                            <div class="metric-label">Memory Usage</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${(info.disk.total / 1024 / 1024 / 1024).toFixed(1)}GB</div>
                            <div class="metric-label">Disk Total</div>
                        </div>
                        <div class="metric">
                            <div class="metric-value">${info.disk.percent.toFixed(1)}%</div>
                            <div class="metric-label">Disk Usage</div>
                        </div>
                    </div>
                `;
            } catch (error) {
                showMessage('system-info', `Failed to load system info: ${error.message}`, 'error');
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            refreshHealth();
            getLatentSpaceStatus();
            getModelStatus();
            getMinuteLogStats();
            getSystemInfo();
            
            // Auto-refresh charts every 30 seconds
            setInterval(() => {
                refreshHealth();
                getLatentSpaceStatus();
                getMinuteLogStats();
            }, 30000);
        });

        // Filter functions
        function filterLogs() {
            const searchTerm = document.getElementById('log-search').value.toLowerCase();
            const levelFilter = document.getElementById('level-filter').value;
            const sourceFilter = document.getElementById('source-filter').value;
            const rows = document.querySelectorAll('#logs-table tbody tr');
            
            rows.forEach(row => {
                const level = row.getAttribute('data-level');
                const source = row.getAttribute('data-source');
                const message = row.getAttribute('data-message');
                
                const matchesSearch = !searchTerm || message.includes(searchTerm);
                const matchesLevel = !levelFilter || level === levelFilter;
                const matchesSource = !sourceFilter || source === sourceFilter;
                
                row.style.display = matchesSearch && matchesLevel && matchesSource ? '' : 'none';
            });
        }

        function filterMinuteLogs() {
            const searchTerm = document.getElementById('minute-log-search').value.toLowerCase();
            const levelFilter = document.getElementById('minute-level-filter').value;
            const sourceFilter = document.getElementById('minute-source-filter').value;
            const rows = document.querySelectorAll('#minute-logs-table tbody tr');
            
            rows.forEach(row => {
                const level = row.getAttribute('data-level');
                const source = row.getAttribute('data-source');
                const message = row.getAttribute('data-message');
                
                const matchesSearch = !searchTerm || message.includes(searchTerm);
                const matchesLevel = !levelFilter || level === levelFilter;
                const matchesSource = !sourceFilter || source === sourceFilter;
                
                row.style.display = matchesSearch && matchesLevel && matchesSource ? '' : 'none';
            });
        }

        // Export functions
        function exportLogs() {
            const table = document.getElementById('logs-table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const visibleRows = rows.filter(row => row.style.display !== 'none');
            
            let csv = 'Timestamp,Level,Source,Message,Metadata\n';
            
            visibleRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const timestamp = cells[0].textContent;
                const level = cells[1].textContent;
                const source = cells[2].textContent;
                const message = cells[3].textContent.replace(/"/g, '""');
                const metadata = cells[4].textContent.replace(/"/g, '""');
                
                csv += `"${timestamp}","${level}","${source}","${message}","${metadata}"\n`;
            });
            
            downloadCSV(csv, 'recent_logs.csv');
        }

        function exportMinuteLogs() {
            const table = document.getElementById('minute-logs-table');
            const rows = Array.from(table.querySelectorAll('tbody tr'));
            const visibleRows = rows.filter(row => row.style.display !== 'none');
            
            let csv = 'Timestamp,Level,Source,Message,Metadata\n';
            
            visibleRows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const timestamp = cells[0].textContent;
                const level = cells[1].textContent;
                const source = cells[2].textContent;
                const message = cells[3].textContent.replace(/"/g, '""');
                const metadata = cells[4].textContent.replace(/"/g, '""');
                
                csv += `"${timestamp}","${level}","${source}","${message}","${metadata}"\n`;
            });
            
            downloadCSV(csv, 'minute_logs.csv');
        }

        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Handle Enter key in question textarea
        document.getElementById('question').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                askQuestion();
            }
        });
    </script>
</body>
</html>
